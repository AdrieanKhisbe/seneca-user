<h1>seneca-user</h1>

<h2>A user management plugin for the <a href="http://senecajs.org">Seneca</a> toolkit</h2>

<p>This module is a plugin for the Seneca framework. It provides business logic for user management, such as:</p>

<ul>
<li>login</li>
<li>logout</li>
<li>registration</li>
<li>password handling</li>
</ul>

<p>There are two core concepts: user and login. A <em>user</em>, storing the user account details and encrypted passwords, <br />and a <em>login</em>, representing an instance of a user that has been authenticated. A user can have multiple logins.</p>

<p>This module does not make any assumptions about the context it runs in. <br />Use the <a href="http://github.com/rjrodger/seneca-auth">seneca-auth</a> plugin to handle web and social media authentication.</p>

<h2>Support</h2>

<p>If you're using this module, feel free to contact me on twitter if you<br />have any questions! :) <a href="http://twitter.com/rjrodger">@rjrodger</a></p>

<p>Current Version: 0.2.1 </p>

<p>Tested on: node 0.8.16, seneca 0.5.3</p>

<p><a href="http://travis-ci.org/rjrodger/seneca-user"><img src="https://secure.travis-ci.org/rjrodger/seneca-user.png" alt="Build Status" title="" /></a></p>

<h2>Quick example</h2>

<div class="highlight"><pre lang="JavaScript">var seneca = require('seneca')()
seneca.use('user')

seneca.ready(function(){

  var userpin = seneca.pin({role:'user',cmd:'*'})

  userpin.register( {name:"Flann O'Brien",email:'<a href='mailto:nincompoop@deselby.com'>nincompoop@deselby.com</a>',password:'blackair'}, function(err,out) {

<pre><code>userpin.login({email:'<a href='mailto:nincompoop@deselby.com'>nincompoop@deselby.com</a>',password:'bicycle'}, function(err,out){
  console.log('login success: '+out.ok)

  userpin.login({email:'<a href='mailto:nincompoop@deselby.com'>nincompoop@deselby.com</a>',password:'blackair'}, function(err,out){
    console.log('login success: '+out.ok)
    console.log('login instance: '+out.login)
  })
})
</code></pre>

  })
})
</pre></div>

<p>This example, uses a <em>pin</em> for convenience: <code>userpin.register( ... )</code> is the same as <br /><code>seneca.act({role:'user',cmd:'register', ... )</code>.</p>

<p>In the example code, a user is registered, and then two login attempts are made. The first with an incorrect password, the second with the correct<br />password. The successful login provides a login instance. The <em>login.token</em> property can be used to authenticate this login. For example,<br />the <a href="http://github.com/rjrodger/seneca-auth">seneca-auth</a> plugin uses this token as a HTTP authentication cookie.</p>

<h2>Deeper example</h2>

<p>Take a look at the <a href="http://github.com/rjrodger/seneca-examples">user accounts example</a>.</p>

<h2>Install</h2>

<div class="highlight"><pre lang="sh">npm install seneca
npm install seneca-user
</pre></div>

<p>You'll need the <a href="http://github.com/rjrodger/seneca">seneca</a> module to use this module - it's just a plugin.</p>

<h2>Usage</h2>

<p>To load the plugin:</p>

<div class="highlight"><pre lang="JavaScript">seneca.use('user', { ... options ... })
</pre></div>

<p>The user and login data is persisted using seneca entities. These have<br />names <em>sys_user</em> and <em>sys_login</em> by default, but can be changed in the<br />options.</p>

<p>Passwords are not stored in plaintext, but using a salted SHA hash. In<br />the context of password reminder functionality, this means you can<br />generate new passwords, but cannot recover old ones. <br /><a href="http://www.codinghorror.com/blog/2007/09/youre-probably-storing-passwords-incorrectly.html">This is what you want</a>.</p>

<p>There are separate actions to encrypt and verify passwords, so you can do things your own way if you like.</p>

<p>To support different use cases, users can be identified by either a<br /><em>nick</em> or their email address. The <em>nick</em> property is the traditional<br />'username', but does not need to be used in this fashion (hence the name 'nick').</p>

<h2>Options</h2>

<ul>
<li><em>user</em>: spec for user entity type, default: {zone:null, base:'sys', name:'user'}. </li>
<li><em>login</em>: spec for user entity type, default: {zone:null, base:'sys', name:'login'}. </li>
</ul>

<h2>Entities</h2>

<h3>User</h3>

<p>The user entity has a default type of <em>/sys/user</em> and standard properties:</p>

<ul>
<li><em>nick</em>: username</li>
</ul>

<p>You can add your own properties, but be careful not to use the standard property names.</p>

<h3>Login</h3>

<p>The login entity has a default type of <em>/sys/login</em> and standard properties:</p>

<ul>
<li><em>token</em>: authentication token</li>
</ul>

<p>You can add your own properties, but be careful not to use the standard property names.</p>

<h2>Actions</h2>

<h3>role:user, cmd:login</h3>

<p>Login an existing user. Creates a new sys_login entry.</p>

<h4>Arguments:</h4>

<ul>
<li><em>nick</em>: required if no email, identifies user</li>
<li><em>email</em>: required if no nick, identifies user</li>
<li><em>password</em>: password as entered by user</li>
<li><em>auto</em>: automatic login without password, default: <em>false</em>. Use this to generate login tokens.</li>
</ul>

<h4>Provides:</h4>

<p>Object with properties:</p>

<ul>
<li>ok: true if login succeeded, false if not</li>
<li>login: login entity, includes login.token property</li>
</ul>

<h3>role:user, cmd:entity</h3>

<p>Provide an instance of the user or login entities. Used by other<br />plugins to get the right entity type for additional user operations.</p>

<p>Arguments:</p>

<ul>
<li><em>kind</em>: 'user' or 'login'</li>
</ul>
